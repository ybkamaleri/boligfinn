#' Create table from Finn search
#'
#' @param ... Extra arguments
#' @inheritParams get_html
#'
#' @importFrom utils setTxtProgressBar txtProgressBar
#' @export

finn <- function(area = 1:5, pmin = 3, pmax = 5, add = NULL, ...){

    ## Get html
    finnHTML <- get_html(area = area, pmin = pmin, pmax = pmax, add = add)

    ## List of Finn codes for the specified parameters
    finnCodes <- get_finn(finnHTML)


    ## Set progress bar
    pb <- txtProgressBar(min = 0, max = length(finnCodes), style = 3)

    finnTabel <- list()

    for (i in 1:length(finnCodes)){

        ## Progress bar
        setTxtProgressBar(pb, i)

        ## Detail info for a selected flat
        aptCode <- get_flat(finnCodes[i])

        ## Address
        aptAdd <- get_add(aptCode)

        ## price
        aptPrice <- get_price(aptCode)

        ## Total price
        aptTotal <- get_total(aptCode)

        ## Monthly rent
        aptMonth <- get_month(aptCode)

        ## Common dept
        aptDebt <- get_debt(aptCode)

        ## type
        aptType <- get_type(aptCode)

        ## size
        aptSize <- get_size(aptCode)

        ## balcony
        aptBalcony <- get_balcony(aptCode)

        ## ownership
        aptForm <- get_form(aptCode)

        ## postcode
        aptPost <- get_add(aptCode, postcode = TRUE)

        ## visit date
        aptVisit <- get_date(aptCode)



        tempTab <- list(price = aptPrice,
                        total = aptTotal,
                        month = aptMonth,
                        debt = aptDebt,
                        type = aptType,
                        size = aptSize,
                        balcony = aptBalcony,
                        form = aptForm,
                        address = aptAdd,
                        postcode = aptPost,
                        visit = aptVisit)

        finnTabel[[i]] <- tempTab
    }

    ## stop Progress bar
    close(pb)

    ## Create table
    finnTabel <- data.table::rbindlist(finnTabel)

    return(finnTabel)
}
